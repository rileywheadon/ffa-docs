<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Model Selection - FFA Framework</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Model Selection";
        var mkdocs_page_input_path = "model-selection.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> FFA Framework
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">R Package</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../r-installation-instructions/">Installation instructions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../r-user-manual.pdf">User Manual</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vignettes/">Vignettes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Exploratory Data Analysis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../eda-introduction/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../eda-change-points/">Change Points</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../eda-trend-ams-mean/">Trends in AMS Mean</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../eda-trend-ams-variability/">Trends in AMS Variability</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Flood Frequency Analysis</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../ffa-introduction/">Introduction</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../probability-distributions/">Probability Distributions</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Model Selection</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#an-introduction-to-l-moments">An Introduction to L-Moments</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#sample-l-moments-from-pwms-and-l-moment-ratios">Sample L-Moments (from PWMs) and L-Moment Ratios</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#example-plot">Example Plot</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#selection-metrics">Selection Metrics</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-l-distance">1. L-Distance</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-l-kurtosis">2. L-Kurtosis</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-z-statistic">3. Z-statistic</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#handling-nonstationarity">Handling Nonstationarity</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#decomposition-steps">Decomposition Steps</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#scenario-1-trend-in-mean">Scenario 1: Trend in mean</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#scenario-2-trend-in-standard-deviation">Scenario 2: Trend in standard deviation</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#scenario-3-trend-in-both-mean-and-standard-deviation">Scenario 3: Trend in both mean and standard deviation</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../parameter-estimation/">Parameter Estimation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uncertainty-quantification/">Uncertainty Quantification</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../model-assessment/">Model Assessment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../goals/">Goals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../release-notes/">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../matlab-version/">MATLAB Version</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../license/">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FFA Framework</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Flood Frequency Analysis</li>
      <li class="breadcrumb-item active">Model Selection</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="model-selection">Model Selection</h1>
<p>This module selects a statistical model for S-FFA or NS-FFA based on the annual maximum series.</p>
<ul>
<li><strong>S-FFA</strong>: A time-invariant probability distribution is selected from the candidate distributions.</li>
<li><strong>NS-FFA</strong>: A distribution is chosen along with a nonstationary structure to capture its evolution over time. In piecewise NS-FFA, the series is segmented into subperiods, each modelled with either time-invariant or time-varying distributions.</li>
</ul>
<p>The framework uses the <strong>L-moment ratio method</strong> to identify the best-fit distribution family by comparing sample L-moments with the L-moments of various distribution families.</p>
<p>For NS-FFA, the series is decomposed to isolate its stationary component following <a href="https://doi.org/10.1016/j.jhydrol.2022.128186">Vidrio-Sahag√∫n and He (2022)</a>.
This decomposed sample is then used for distribution selection, as in S-FFA.</p>
<h2 id="an-introduction-to-l-moments">An Introduction to L-Moments</h2>
<p><strong>Definition 1</strong>: The <strong><span class="arithmatex">\(k\)</span>-th Order Statistic</strong> of a statistical sample is its <span class="arithmatex">\(k\)</span>-th smallest value.</p>
<p><strong>Definition 2</strong>: The <strong><span class="arithmatex">\(r\)</span>-th Population L-moment</strong> <span class="arithmatex">\(\lambda_{r}\)</span> is a linear combination of the expectation of the order statistics. Let <span class="arithmatex">\(X_{k:n}\)</span> be the <span class="arithmatex">\(k\)</span>-th order statistic from a sample of size <span class="arithmatex">\(n\)</span>. Then,</p>
<div class="arithmatex">\[
\lambda_{r} = \frac{1}{r} \sum_{k=0}^{r-1} (-1)^{k} \binom{r-1}{k} \mathbb{E}[X_{r-k:r}]
\]</div>
<p><strong>Definition 3</strong>: A <strong>Probability Weighted Moment</strong> (PWM) encodes information about a value's position on the cumulative distribution function. The <span class="arithmatex">\(r\)</span>-th PWM, denoted <span class="arithmatex">\(\beta_{r}\)</span>, is:</p>
<div class="arithmatex">\[
\beta_{r} = \mathbb{E}[X \cdot  F(X)^{r}]
\]</div>
<p>For an ordered sample <span class="arithmatex">\(x_{1:n} \leq  \dots  \leq  x_{n:n}\)</span>, the sample PWM is often estimated as:</p>
<div class="arithmatex">\[
b_{r} = \frac{1}{n} \sum_{i=1}^{r} x_{i:n} \left(\frac{i-1}{n-1}\right) ^{r}
\]</div>
<h3 id="sample-l-moments-from-pwms-and-l-moment-ratios">Sample L-Moments (from PWMs) and L-Moment Ratios</h3>
<p>The first four sample L-moments can be computed as linear combinations of the PWMs:</p>
<div class="arithmatex">\[
\begin{aligned}
l_{1} &amp;= b_{0} \\
l_{2} &amp;= 2b_{1} - b_{0} \\
l_{3} &amp;= 6b_{2} - 6b_{1} + b_{0} \\
l_{4} &amp;= 20b_{3} - 30b_{2} + 12b_{1} - b_{0}
\end{aligned}
\]</div>
<p>The L-moments are used to compute the <strong>Sample L-variance</strong> <span class="arithmatex">\(t_{2}\)</span>, <strong>Sample L-skewness</strong> <span class="arithmatex">\(t_{3}\)</span> and the <strong>Sample L-kurtosis</strong> <span class="arithmatex">\(t_{4}\)</span> using the following formulas:</p>
<div class="arithmatex">\[
\begin{aligned}
t_{2} &amp;= l_{2} / l_{1} \\
t_{3} &amp;= l_{3} / l_{2} \\ 
t_{4} &amp;= l_{4} / l_{2}
\end{aligned}
\]</div>
<p>Then, we compare these statistics, specifically the L-skewness and L-kurtosis to their theoretical values (given <a href="../probability-distributions/">here</a>) using one of three different metrics to select a distribution.</p>
<p><strong>Note</strong>: Probability distributions with two parameters have constant L-skewness <span class="arithmatex">\(\tau_{3}\)</span> and L-kurtosis <span class="arithmatex">\(\tau_{4}\)</span> regardless of their parameters.
The L-skewness and L-kurtosis of probability distributions with three parameters is a function of the shape parameter <span class="arithmatex">\(\kappa\)</span>.
The notation <span class="arithmatex">\(\tau_{3}(\kappa)\)</span> and <span class="arithmatex">\(\tau_{4}(\kappa)\)</span> refers to the L-skewness and L-kurtosis <em>curves</em> for three parameter distributions.</p>
<h3 id="example-plot">Example Plot</h3>
<p>Shown below are the L-moment curves of the GEV, GLO, GNO, PE3/LP3, and WEI distributions as well as the L-moment ratios of the two parameter distributions GUM and NOR/LNO.
This L-moment diagram depicts the "L-distance" selection metric, which compares the euclidian distance between the sample and theoretical L-moment ratios.
The inset shows that the GEV distribution (yellow line) has the closest L-moments to the data.</p>
<p><img alt="" src="../img/plot-lmom.png" /></p>
<h2 id="selection-metrics">Selection Metrics</h2>
<h3 id="1-l-distance">1. L-Distance</h3>
<p>The Euclidean distance between the sample <span class="arithmatex">\((t_3, t_4)\)</span> and theoretical <span class="arithmatex">\((\tau_3, \tau_4)\)</span> for each candidate distribution.
For 3-parameter distributions, this is the <strong>minimum</strong> distance along their L-moment ratio curve.</p>
<h3 id="2-l-kurtosis">2. L-Kurtosis</h3>
<p>The L-kurtosis method is only used for three-parameter probability distributions.
First, the shape parameter <span class="arithmatex">\(\kappa^{*}\)</span> such that <span class="arithmatex">\(t_{3} = \tau _{3}(\kappa ^{*})\)</span> is identified.
Then, the difference between the sample L-kurtosis and the theoretical L-kurtosis is computed using the metric <span class="arithmatex">\(|\tau_{4}(\kappa ^{*}) - t_{4} |\)</span>.</p>
<h3 id="3-z-statistic">3. Z-statistic</h3>
<p>The Z-statistic selection metric is calculated as follows (for three-parameter distributions):</p>
<ol>
<li>Fit the four-parameter Kappa (K4D) distribution to the sample.</li>
<li>Generate <span class="arithmatex">\(N_{\text{sim}}\)</span> bootstrap samples from the fitted K4D distribution.</li>
<li>Calculate the sample L-kurtosis <span class="arithmatex">\(t_{4}^{[i]}\)</span> of each synthetic dataset.</li>
<li>
<p>Calculate the bias and standard deviation of the bootstrap distribution:</p>
<div class="arithmatex">\[
B_{4} = N_{\text{sim} }^{-1} \sum_{i = 1}^{N_{\text{sim} }} \left(t_{4}^{[i]} - t_{4}^{s}\right)
\]</div>
<div class="arithmatex">\[
\sigma _{4} = \left[(N_{\text{sim} } - 1)^{-1} \left\{\sum_{i - 1}^{N_{\text{sim} }} \left(t_{4}^{[i]} - t_{4}^{s}\right)^2 - N_{\text{sim} } B_{4}^2\right\} \right] ^{\frac{1}{2}}
\]</div>
</li>
<li>
<p>Identify the shape parameter <span class="arithmatex">\(\kappa^{*}\)</span> such that <span class="arithmatex">\(t_{3} = \tau _{3}(\kappa ^{*})\)</span>.</p>
</li>
<li>
<p>Use the bootstrap distribution to compute the Z-statistic for each distribution:</p>
<div class="arithmatex">\[
z = \frac{\tau_{4} (\kappa ^{*}) - t_{4} + B_{4} }{ \sigma _{4}}
\]</div>
</li>
<li>
<p>Choose the distribution with the <em>smallest</em> Z-statistic.</p>
</li>
</ol>
<h2 id="handling-nonstationarity">Handling Nonstationarity</h2>
<p>When nonstationarity is detected, the annual maximum series is decomposed before model selection. We consider three nonstationary scenarios that can be identified in EDA:</p>
<ol>
<li>Trend in mean only.</li>
<li>Trend in standard deviation only.</li>
<li>Trend in both mean and standard deviation.</li>
</ol>
<h3 id="decomposition-steps">Decomposition Steps</h3>
<h4 id="scenario-1-trend-in-mean">Scenario 1: Trend in mean</h4>
<ol>
<li>Use <a href="../eda-trend-ams-mean/#sens-trend-estimator">Sen's Trend Estimator</a> to approximate the slope <span class="arithmatex">\(b_1\)</span> and intercept <span class="arithmatex">\(b_0\)</span>.</li>
<li>Detrend: subtract the linear function <span class="arithmatex">\((b_{1} \cdot \text{Covariate})\)</span> from the time series, where the <em>covariate</em> is a time index calculated using the formula <span class="arithmatex">\((\text{Years} - 1900) / 100\)</span>.</li>
<li>Ensure positivity: if necessary, shift series by adding a constant such that <span class="arithmatex">\(\min(\text{data}) = 1\)</span>.</li>
</ol>
<h4 id="scenario-2-trend-in-standard-deviation">Scenario 2: Trend in standard deviation</h4>
<ol>
<li>Generate a time series of standard deviations using the moving windows method.</li>
<li>Use <a href="../eda-trend-ams-variability/#sens-trend-estimator">Sen's Trend Estimator</a> to identify the slope <span class="arithmatex">\(c_{1}\)</span> and intercept <span class="arithmatex">\(c_{0}\)</span> of the trend in the standard deviations.</li>
<li>
<p>Normalize the data to have mean <span class="arithmatex">\(0\)</span>, then divide out the scale factor <span class="arithmatex">\(g_{t}\)</span>.</p>
<div class="arithmatex">\[
g_{t} = \frac{(c_{1} \cdot  \text{Covariate} ) + c_{0}}{c_{0}}
\]</div>
</li>
<li>
<p>Add back the long-term mean <span class="arithmatex">\(\mu\)</span>, and then ensure positivity as in Scenario 1.</p>
</li>
</ol>
<h4 id="scenario-3-trend-in-both-mean-and-standard-deviation">Scenario 3: Trend in both mean and standard deviation</h4>
<ol>
<li>Remove the linear trend in mean exactly as in Scenario 1.</li>
<li>On that detrended series, generate a rolling‚Äêwindow STD series and fit its trend.</li>
<li>Divide the detrended data by the time-varying scale factor <span class="arithmatex">\(g_{t}\)</span> (as in Scenario 2).</li>
<li>Shift to preserve the series mean and ensure positivity.</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../probability-distributions/" class="btn btn-neutral float-left" title="Probability Distributions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../parameter-estimation/" class="btn btn-neutral float-right" title="Parameter Estimation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../probability-distributions/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../parameter-estimation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-chtml-full.min.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
