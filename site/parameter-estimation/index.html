<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Parameter Estimation - FFA Framework</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Parameter Estimation";
        var mkdocs_page_input_path = "parameter-estimation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> FFA Framework
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">R Package</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../r-documentation.pdf">Documentation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Command Line Interface</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cli-installation/">Installation Instructions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cli-manual/">User Manual</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Concepts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../eda/">Exploratory Data Analysis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../model-selection/">Model Selection</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Parameter Estimation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#l-moments">L-Moments</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#maximum-likelihood-mle">Maximum Likelihood (MLE)</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#two-parameter-distributions">Two Parameter Distributions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#gumbel-gum-distribution">Gumbel (GUM) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#normal-nor-distribution">Normal (NOR) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#log-normal-lno-distribution">Log-Normal (LNO) Distribution</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#three-parameter-distributions">Three Parameter Distributions</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#generalized-extreme-value-gev-distribution">Generalized Extreme Value (GEV) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#generalized-logistic-glo-distribution">Generalized Logistic (GLO) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#generalized-normal-gno-distribution">Generalized Normal (GNO) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pearson-type-iii-pe3-distribution">Pearson Type III (PE3) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#log-pearson-type-iii-lp3-distribution">Log-Pearson Type III (LP3) Distribution</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#weibull-wei-distribution">Weibull (WEI) Distribution</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#generalized-maximum-likelihood-gmle">Generalized Maximum Likelihood (GMLE)</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../frequency-analysis/">Frequency Analysis</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uncertainty-quantification/">Uncertainty Quantification</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../model-assessment/">Model Assessment</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../goals/">Goals</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../roadmap/">Roadmap</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../changelog/">Release Notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../matlab/">MATLAB Version</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../license/">License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FFA Framework</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Concepts</li>
      <li class="breadcrumb-item active">Parameter Estimation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="parameter-estimation">Parameter Estimation</h1>
<p>The FFA framework implements three methods for parameter estimation:</p>
<ol>
<li>L-moments</li>
<li>Maximum likelihood (MLE)</li>
<li>Generalized maximum likelihood (GMLE)</li>
</ol>
<p><strong>Note</strong>: The parameterization used for the GEV distributions is different from the parameterization used by the <code>lmom</code> library. 
In particular, the sign of the shape parameter is inverted for consistency with "Regional Frequency Analysis" (Hosking, 1997).</p>
<h2 id="l-moments">L-Moments</h2>
<p>The method estimates parameter values based on the sample L-moments <span class="arithmatex">\(l_{1}\)</span>, <span class="arithmatex">\(l_{2}\)</span> and the sample L-moment ratios <span class="arithmatex">\(t_{3}\)</span>, <span class="arithmatex">\(t_{4}\)</span>.
For more information about L-moments, see <a href="../model-selection/#an-introduction-to-l-moments">here</a>.
The parameter estimation methods are based on <a href="https://lib.stat.cmu.edu/general/lmoments">these</a> Fortran routines by J.R.M. Hosking.
In particular, we use the <a href="https://cran.r-project.org/web/packages/lmom/lmom.pdf">lmom</a> CRAN package, which implements the aformentioned Fotran routines.</p>
<p><strong>Warning</strong>: L-moments parameter estimation can yield distributions which do not have support at small values.
This is generally not an issue, since we are only interested in the higher quantiles of the distrbution.
However, it is important to remember that the probability distributions produced by L-moments <em>should not</em> be used to predict future streamflow data in general.</p>
<h2 id="maximum-likelihood-mle">Maximum Likelihood (MLE)</h2>
<p>For all distributions below, let <span class="arithmatex">\(x\)</span> be a vector of data with elements <span class="arithmatex">\(x_{1}, \dots, x_{n}\)</span>.</p>
<h3 id="two-parameter-distributions">Two Parameter Distributions</h3>
<p>For a two-parameter distribution <code>XXX</code>, we use three different models:</p>
<ol>
<li><code>XXX</code> is the standard model with no non-stationarity.</li>
<li><code>XXX10</code> has a trend in the location parameter <span class="arithmatex">\(\mu\)</span>.</li>
<li><code>XXX11</code> has a trend in the location <span class="arithmatex">\(\mu\)</span> and the scale <span class="arithmatex">\(\sigma\)</span>.</li>
</ol>
<p>Shown below is a table summarizing these three models:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th><code>XXX</code></th>
<th><code>XXX10</code></th>
<th><code>XXX11</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Location <span class="arithmatex">\(\mu\)</span></td>
<td>constant</td>
<td><span class="arithmatex">\(\mu_0 + \mu_1z\)</span></td>
<td><span class="arithmatex">\(\mu_0 + \mu_1z\)</span></td>
</tr>
<tr>
<td>Scale <span class="arithmatex">\(\sigma\)</span></td>
<td>constant</td>
<td>constant</td>
<td><span class="arithmatex">\(\sigma_0 + \sigma_1z\)</span></td>
</tr>
<tr>
<td>Number of Parameters</td>
<td>2</td>
<td>3</td>
<td>4</td>
</tr>
</tbody>
</table>
<h4 id="gumbel-gum-distribution">Gumbel (GUM) Distribution</h4>
<p>The probability density function (PDF) of the Gumbel distribution is as follows:</p>
<div class="arithmatex">\[
f(x_{i} : \mu, \sigma) = \frac{1}{\sigma} \exp \left(-z_{i} - e^{-z_{i}}\right) , \quad
z_{i} = \frac{x_{i} - \mu}{\sigma }
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma) = \sum_{i=1}^{n} \left[-\ln \sigma - z_{i} - e^{-z_{i}} \right]
\]</div>
<h4 id="normal-nor-distribution">Normal (NOR) Distribution</h4>
<p>The probability density function (PDF) of the Normal distribution is as follows:</p>
<div class="arithmatex">\[
f(x_{i} : \mu, \sigma) = \frac{1}{\sigma \sqrt{2\pi }}e^{-z_{i}^2/2} , \quad
z_{i} = \frac{x_{i} - \mu}{\sigma }
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma) = \sum_{i=1}^{n} \left[-\ln (\sigma \sqrt{2\pi }) - \frac{z_{i}^2}{2} \right]
\]</div>
<h4 id="log-normal-lno-distribution">Log-Normal (LNO) Distribution</h4>
<p>To perform MLE using the LNO distribution, we use the fact that:</p>
<div class="arithmatex">\[
\text{Data} \sim \text{LNO} \Leftrightarrow \ln (\text{Data}) \sim \text{NOR}
\]</div>
<p>Precisely, we require the change of variables formula, which states that:</p>
<div class="arithmatex">\[
\ell_{\text{LNO}}(x ; \mu, \sigma) 
= \ell_{\text{NOR}}(\ln x ; \mu , \sigma) \left|\frac{d}{dx} \ln  x\right| 
= \frac{\ell_{\text{NOR}}(\ln x ; \mu , \sigma)}{x}  
\]</div>
<h3 id="three-parameter-distributions">Three Parameter Distributions</h3>
<p>For a three-parameter distribution <code>XXX</code>, we use three different models:</p>
<ol>
<li><code>XXX</code> is the standard model with no non-stationarity.</li>
<li><code>XXX100</code> has a trend in the location parameter <span class="arithmatex">\(\mu\)</span>.</li>
<li><code>XXX110</code> has a trend in the location <span class="arithmatex">\(\mu\)</span> and the scale <span class="arithmatex">\(\sigma\)</span>.</li>
</ol>
<p>Shown below is a table summarizing these three models:</p>
<table>
<thead>
<tr>
<th>Feature</th>
<th><code>XXX</code></th>
<th><code>XXX100</code></th>
<th><code>XXX110</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Location <span class="arithmatex">\(\mu\)</span></td>
<td>constant</td>
<td><span class="arithmatex">\(\mu_0 + \mu_1z\)</span></td>
<td><span class="arithmatex">\(\mu_0 + \mu_1z\)</span></td>
</tr>
<tr>
<td>Scale <span class="arithmatex">\(\sigma\)</span></td>
<td>constant</td>
<td>constant</td>
<td><span class="arithmatex">\(\sigma_0 + \sigma_1z\)</span></td>
</tr>
<tr>
<td>Shape <span class="arithmatex">\(\kappa\)</span></td>
<td>constant</td>
<td>constant</td>
<td>constant</td>
</tr>
<tr>
<td>Number of Parameters</td>
<td>3</td>
<td>4</td>
<td>5</td>
</tr>
</tbody>
</table>
<h4 id="generalized-extreme-value-gev-distribution">Generalized Extreme Value (GEV) Distribution</h4>
<p>The probability density function (PDF) of the GEV distribution is as follows (assume <span class="arithmatex">\(t_{i} &gt; 0)\)</span>:</p>
<div class="arithmatex">\[
f(x_{i} : \mu, \sigma, \kappa) = \frac{1}{\sigma}t_{i}^{-1 - (1/\kappa)} \exp (-t_{i}^{-1/\kappa}), \quad
t_{i} = 1 + \kappa \left(\frac{x_{i} - \mu }{\sigma } \right)
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma, \kappa) = \sum_{i=1}^{n} \left[-\ln \sigma - \left(1 + \frac{1}{\kappa }\right) \ln t_{i} - t_{i}^{-1/\kappa}\right]
\]</div>
<h4 id="generalized-logistic-glo-distribution">Generalized Logistic (GLO) Distribution</h4>
<p>The probability density function (PDF) of the GLO distribution is as follows (assume <span class="arithmatex">\(t_{i} &gt; 0)\)</span>:</p>
<div class="arithmatex">\[
f(x_{i} : \mu , \sigma , \kappa ) = \frac{1}{\sigma }t_{i}^{(1/\kappa) - 1} \left[1 + t_{i}^{1/\kappa}\right]^{-2}, \quad
t_{i} = 1 - \kappa \left(\frac{x_{i} - \mu }{\sigma }\right)
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma, \kappa) = \sum_{i=1}^{n} \left[-\ln \sigma + \left(\frac{1}{\kappa }-1\right) \ln t_{i} - 2 \ln \left(1 + t_{i}^{1/\kappa }\right) \right]
\]</div>
<h4 id="generalized-normal-gno-distribution">Generalized Normal (GNO) Distribution</h4>
<p>The probability density function (PDF) of the GNO distribution is as follows (assume <span class="arithmatex">\(t_{i} &gt; 0)\)</span>:</p>
<div class="arithmatex">\[
f(x_{i} : \mu , \sigma , \kappa ) = \frac{1}{\sigma \sqrt{2\pi }} t_{i}^{-1} \exp \left[-\frac{(\ln t_{i})^2}{2\kappa ^2}\right], \quad
t_{i} = 1 - \kappa \left(\frac{x - \mu }{\sigma }\right)
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma, \kappa) = \sum_{i=1}^{n} \left[- \ln (\sigma \sqrt{2\pi }) - \ln t_{i} - \frac{(\ln t_{i})^2}{2\kappa ^2}\right]
\]</div>
<h4 id="pearson-type-iii-pe3-distribution">Pearson Type III (PE3) Distribution</h4>
<p>The probability density function (PDF) of the PE3 distribution is as follows:</p>
<div class="arithmatex">\[
\begin{aligned}
f(x_{i} : \mu , \sigma , \kappa ) = \frac{(x_{i} - \xi)^{\alpha  - 1}e^{-(x_{i} - \xi )/\beta }}{\beta ^{\alpha } \Gamma (\alpha )} \\[5pt]
\alpha = \frac{4}{\kappa^2}, \quad
\beta = \frac{\sigma |\kappa|}{2}, \quad
\xi  = \mu  - \frac{2\sigma }{\kappa }
\end{aligned}
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma, \kappa) = \sum_{i=1}^{n} \left[(\alpha  - 1) \ln |x_{i} - \xi | - \frac{|x_{i} - \xi  |}{\beta } - \alpha \ln\beta  - \ln \Gamma (\alpha )\right]
\]</div>
<h4 id="log-pearson-type-iii-lp3-distribution">Log-Pearson Type III (LP3) Distribution</h4>
<p>To perform MLE using the LP3 distribution, we use the fact that:</p>
<div class="arithmatex">\[
\text{Data} \sim \text{LP3}  \Leftrightarrow \ln (\text{Data}) \sim \text{PE3}
\]</div>
<p>Precisely, we require the change of variables formula, which states that:</p>
<div class="arithmatex">\[
\ell_{\text{LP3}}(x ; \mu, \sigma, \kappa) 
= \ell_{\text{PE3}}(\ln x ; \mu , \sigma, \kappa ) \left|\frac{d}{dx} \ln  x\right| 
= \frac{\ell_{\text{PE3}}(\ln x ; \mu , \sigma, \kappa )}{x}  
\]</div>
<h4 id="weibull-wei-distribution">Weibull (WEI) Distribution</h4>
<p>The probability density function (PDF) of the Weibull distribution is as follows for <span class="arithmatex">\(x_{i} &gt; \mu\)</span>:</p>
<div class="arithmatex">\[
f(x_{i} : \mu, \sigma, \kappa) = \frac{\kappa}{\sigma }\left(\frac{x_{i} - \mu}{\sigma }\right)^{\kappa -1} \exp \left( - \left(\frac{x_{i} - \mu}{\sigma }\right)^{\kappa } \right)
\]</div>
<p>Therefore, the Log-likelihood function is defined as follows:</p>
<div class="arithmatex">\[
\ell(x:\mu, \sigma, \kappa) = \sum_{i=1}^{n} \left[\ln \kappa - \kappa \ln \sigma +(\kappa -1)\ln (x_{i}-\mu ) - \left(\frac{x_{i} - \mu }{\sigma }\right) ^{\kappa } \right]
\]</div>
<h2 id="generalized-maximum-likelihood-gmle">Generalized Maximum Likelihood (GMLE)</h2>
<p>The generalized maximum likelihood (GMLE) parameter estimation method is used to determine the parameters of the generalized extreme value (GEV) distribution given a prior distribution for the shape parameter <span class="arithmatex">\(\kappa\)</span>.
This method uses <a href="https://en.wikipedia.org/wiki/Maximum_a_posteriori_estimation">maximum a posteriori estimation</a>, which maximizes the product of the likelihood and the prior distribution.</p>
<p>Suppose that <span class="arithmatex">\(\kappa\)</span> is drawn from a random variable <span class="arithmatex">\(K \sim \text{Beta}(p, q)\)</span> where <span class="arithmatex">\(p\)</span> and <span class="arithmatex">\(q\)</span> are determined using prior knowledge. 
The prior PDF <span class="arithmatex">\(f_{K}(\kappa)\)</span> is shown below, where <span class="arithmatex">\(B(p, q)\)</span> is the <a href="https://en.wikipedia.org/wiki/Beta_function">Beta function</a>.</p>
<div class="arithmatex">\[
f_{K}(\kappa) = \frac{\kappa ^{p - 1}(1 - \kappa)^{q-1}}{B(p, q)}
\]</div>
<p>As in the case of regular maximum likelihood estimation, the likelihood function is:</p>
<div class="arithmatex">\[
f_{X}(x : \mu, \sigma, \kappa) =\prod_{i=1}^{n} \frac{1}{\sigma}t_{i}^{-1 - (1/\kappa)} \exp (-t_{i}^{-1/\kappa}), \quad
t_{i} = 1 + \kappa \left(\frac{x_{i} - \mu }{\sigma } \right)
\]</div>
<p>As mentioned previously, we want to maximize the product <span class="arithmatex">\(\mathcal{L} = f_{K}(\kappa)f_{X}(x:\mu ,\sigma ,\kappa)\)</span>. 
To ensure numerical stability, we will maximize <span class="arithmatex">\(\ln  (\mathcal{L})\)</span> instead, which has the following form:</p>
<div class="arithmatex">\[
\begin{aligned}
\ln(\mathcal{L}) &amp;= \ln(f_{K}(\kappa)) + \ln(f_{X}(x:\mu ,\sigma ,\kappa )) \\[10pt]
\ln(f_{K}(\kappa)) &amp;= (p - 1)\ln \kappa + (q-1) \ln (1 - \kappa)  - \ln (B(p, q)) \\[5pt]
\ln(f_{X}(x:\mu ,\sigma ,\kappa )) &amp;= \sum_{i=1}^{n} \left[-\ln \sigma - \left(1 + \frac{1}{\kappa }\right) \ln t_{i} - t_{i}^{-1/\kappa}\right]
\end{aligned}
\]</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../model-selection/" class="btn btn-neutral float-left" title="Model Selection"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../frequency-analysis/" class="btn btn-neutral float-right" title="Frequency Analysis">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../model-selection/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../frequency-analysis/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-chtml-full.min.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
